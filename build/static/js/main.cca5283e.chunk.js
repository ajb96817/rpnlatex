(this.webpackJsonpeditor=this.webpackJsonpeditor||[]).push([[0],{27:function(e,t,n){},28:function(e,t,n){},37:function(e,t,n){"use strict";n.r(t);var i=n(3),r=n.n(i),s=n(19),a=n.n(s),o=n(7),c=n(0),u=n(1),l=n(2),_=n(8),p=n(5),h=n(4),m=(n(27),n(28),n(17)),d=n.n(m),f=n(6),v=n(22),x=n(9),y={base:{"[alnum]":"self_insert","!":"insert !;concat","#":"insert \\#","@":"insert @","^":"superscript","*":"insert *","~":"insert \\sim","Ctrl+0":"insert 0;subscript","Ctrl+1":"insert -1;superscript","Ctrl+2":"insert 2;superscript","Ctrl+3":"insert 3;superscript","Ctrl+4":"insert 4;superscript","Ctrl+a":"swap","Ctrl+c":"copy_to_clipboard","Ctrl+e":"name exp;insert e;operator mathrm;swap;superscript","Ctrl+i":"pop_to_document","Ctrl+j":"extract_from_document","Ctrl+k":"infix \\,","Ctrl+l":"recenter_document 50","Ctrl+m":"prefix -","Ctrl+o":"name apply_fn;parenthesize;swap;operator mathopen;swap;concat","Ctrl+p":"delimiters ( )","Ctrl+s":"save_file","Ctrl+u":"superscript","Ctrl+v":"paste_from_clipboard","Ctrl+y":"redo","Ctrl+z":"undo","Ctrl+ ":"infix \\,","Ctrl+,":"infix ,","Shift+Enter":"edit_stack_top"," ":"concat autoparenthesize","=":"mode relational","<":"delimiters \\langle \\rangle","+":"infix_plus_or_minus +","-":"infix_plus_or_minus -","]":"operator boldsymbol","[":"delimiters [ ]","(":"delimiters ( )","{":"delimiters \\{ \\}",ArrowUp:"change_document_selection -1","Shift+ArrowUp":"shift_document_selection -1",ArrowDown:"change_document_selection +1","Shift+ArrowDown":"shift_document_selection +1",PageUp:"change_document_selection -5",PageDown:"change_document_selection +5",Home:"change_document_selection -10000",End:"change_document_selection +10000",Tab:"mode stack",Enter:"subscript",Backspace:"pop","`":"superscript","'":"mode symbol",".":"mode decoration",",":"mode infix",")":"mode delimiters","}":"custom_delimiter",";":"mode lowercase_greek",":":"mode uppercase_greek","%":"mode calligraphic","&":"mode script","/":"mode operator",_:"accumulate text","\\":"accumulate latex","|":"mode array",$:"mode config","?":"toggle_popup help",'"':"edit_new_item"},files:{default:"toggle_popup files",d:"delete_selected_file",n:"start_new_file",Enter:"load_selected_file",s:"save_file",S:"save_file_as",ArrowUp:"select_adjacent_file -1",ArrowDown:"select_adjacent_file 1"},keymap:{ArrowUp:"scroll_popup_panel -25",ArrowDown:"scroll_popup_panel 25",default:"toggle_popup keymap"},help:{ArrowUp:"scroll_popup_panel -40",ArrowDown:"scroll_popup_panel 40",default:"toggle_popup help"},stack:{c:"copy_to_clipboard",d:"pop",i:"pop_to_document",I:"copy_to_document",j:"extract_from_document",J:"recall_from_document",l:"recenter_document 50",n:"nip",o:"over",p:"paste_from_clipboard",r:"rot",t:"tuck",u:"unrot",v:"reverse_n",V:"reverse_all",w:"swap",X:"clear_stack",Enter:"dup",Tab:"undo",".":"redo"," ":"dup","!":"export_document_as_text","@":"export_stack_top_as_text",f:"toggle_popup files",k:"toggle_popup keymap"},config:{m:"mode config_math_alignment",r:"config reset_layout",s:"mode config_stack",t:"mode config_theme",z:"mode config_zoom",$:"insert \\$"},config_math_alignment:{d:"config math_align toggle_document",s:"config math_align toggle_stack"},config_stack:{0:"config stack_split 0",1:"config stack_split 10",2:"config stack_split 20",3:"config stack_split 30",4:"config stack_split 40",5:"config stack_split 50",6:"config stack_split 60",7:"config stack_split 70",8:"config stack_split 80",9:"config stack_split 90","*":"config stack_split 100",ArrowLeft:"config stack_side left",ArrowRight:"config stack_side right",ArrowUp:"config stack_side top",ArrowDown:"config stack_side bottom"},config_theme:{0:"config theme default",1:"config theme dawn",2:"config theme dusk",3:"config theme dark"},config_zoom:{0:"config zoom_factor 0","+":"config zoom_factor +","-":"config zoom_factor -"},accumulate:{Enter:"finish_text_input","Shift+Enter":"finish_text_input roman",Escape:"pop",Backspace:"backspace_text_input",default:"append_text_input"},delimiters:{b:"delimiters \\langle \\vert",c:"delimiters \\lceil \\rceil",f:"delimiters \\lfloor \\rfloor",g:"delimiters \\lgroup \\rgroup",i:"delimiters \\langle \\rangle \\vert 2",I:"delimiters \\langle \\rangle \\vert 3",k:"delimiters \\vert \\rangle",m:"delimiters \\lmoustache \\rmoustache",n:"delimiters \\lVert \\rVert",N:"delimiters \\lVert \\rVert",w:"delimiters . \\vert",W:"delimiters . \\vert","|":"delimiters \\vert \\vert","<":"delimiters \\langle \\rangle","(":"delimiters ( )","[":"delimiters [ ]","]":"name doublebrackets;insert \\llbracket;swap;concat;insert \\rrbracket;concat","{":"delimiters \\{ \\}"},custom_delimiters:{1:"custom_delimiter_arity 1",2:"custom_delimiter_arity 2",3:"custom_delimiter_arity 3",4:"custom_delimiter_arity 4",5:"custom_delimiter_arity 5",6:"custom_delimiter_arity 6",7:"custom_delimiter_arity 7",8:"custom_delimiter_arity 8",9:"custom_delimiter_arity 9",c:"custom_delimiter \\lceil",C:"custom_delimiter \\rceil",f:"custom_delimiter \\lfloor",F:"custom_delimiter \\rfloor",g:"custom_delimiter \\lgroup",G:"custom_delimiter \\rgroup",m:"custom_delimiter \\lmoustache",M:"custom_delimiter \\rmoustache",v:"custom_delimiter \\Vert","<":"custom_delimiter \\langle",">":"custom_delimiter \\rangle","(":"custom_delimiter (",")":"custom_delimiter )","[":"custom_delimiter [","]":"custom_delimiter ]","{":"custom_delimiter \\{","}":"custom_delimiter \\}",".":"custom_delimiter .","/":"custom_delimiter /","\\":"custom_delimiter \\backslash","|":"custom_delimiter |"},operator:{1:"name reciprocal;insert 1;swap;operator frac 2",2:"mode squared",a:"apply_operator 1",A:"apply_operator 2",b:"operator binom 2",c:"named_function cos",C:"named_function csc",d:"mode derivative",D:"named_function det",e:"name exp;insert e;operator mathrm;swap;superscript",E:"named_function exp",f:"delimiters . . / 2",g:"named_function argmin",G:"named_function argmax",h:"mode hyperbolic",i:"mode integral_limits",l:"name lim;insert \\limits;swap;subscript;insert \\lim;swap;concat",m:"named_function min",M:"named_function max",n:"named_function ln",N:"named_function log",o:"name apply_fn;parenthesize;swap;operator mathopen;swap;concat",p:"parenthesize;operator Pr",P:"operator phase",q:"operator sqrt",Q:"operator sqrt[3]",s:"named_function sin",S:"named_function sec",t:"named_function tan",T:"named_function cot",u:"name inf;insert \\limits;swap;subscript;insert \\inf;swap;concat",U:"name sup;insert \\limits;swap;subscript;insert \\sup;swap;concat",v:"name Var;parenthesize;insert Var;operator operatorname;swap;concat",V:"name Cov;swap;insert ,;concat;swap;concat;parenthesize;insert Cov;operator operatorname;swap;concat",";":"apply_tag","/":"operator frac 2","\\":"operator tfrac 2","}":"name underbrace;swap;operator underbrace;swap;subscript","{":"name overbrace;swap;operator overbrace;swap;superscript","-":"mode inverse","'":"substitute_defer",Enter:"name subsuperscript;unrot;subscript;swap;superscript"},hyperbolic:{s:"named_function sinh",S:"named_function sech",c:"named_function cosh",C:"named_function csch",t:"named_function tanh",T:"named_function coth"},inverse:{s:"named_function sin -1",S:"named_function sec -1",c:"named_function cos -1",C:"named_function csc -1",t:"named_function tan -1",T:"named_function cot -1",h:"mode inverse_hyperbolic"},inverse_hyperbolic:{s:"named_function sinh -1",S:"named_function sech -1",c:"named_function cosh -1",C:"named_function csch -1",t:"named_function tanh -1",T:"named_function coth -1"},squared:{s:"named_function sin 2",S:"named_function sec 2",c:"named_function cos 2",C:"named_function csc 2",t:"named_function tan 2",T:"named_function cot 2",h:"mode squared_hyperbolic"},squared_hyperbolic:{s:"named_function sinh 2",S:"named_function sech 2",c:"named_function cosh 2",C:"named_function csch 2",t:"named_function tanh 2",T:"named_function coth 2"},integral_limits:{r:"name limits_real;insert -\\infty;subscript;insert \\infty;superscript",n:"name limits_negative;insert -\\infty;subscript;insert 0;superscript",p:"name limits_positive;insert 0;subscript;insert \\infty;superscript",u:"name limits_unit;insert 0;subscript;insert 1;superscript",t:"name limits_trig;insert 0;subscript;insert 2\\pi;superscript",T:"name limits_sym_trig;insert -\\pi;subscript;insert \\pi;superscript"},derivative:{j:"name partial_yx;insert \\partial;swap;concat;swap;insert \\partial;swap;concat;swap;operator frac 2",J:"name partial2_yx;insert 2;superscript;insert \\partial;swap;concat;swap;insert \\partial;insert 2;superscript;swap;concat;swap;operator frac 2",k:"name dy_dx;insert d;swap;concat;swap;insert d;swap;concat;swap;operator frac 2",K:"name d2_y_dx2;insert 2;superscript;insert d;swap;concat;swap;insert d;insert 2;superscript;swap;concat;swap;operator frac 2",q:"name partial_x;insert \\partial;swap;concat;insert \\partial;swap;operator frac 2",Q:"name partial2_x2;insert 2;superscript;insert \\partial;swap;concat;insert \\partial;insert 2;superscript;swap;operator frac 2",x:"name d_dx;insert d;swap;concat;insert d;swap;operator frac 2",X:"name d2_dx2;insert 2;superscript;insert d;swap;concat;insert d;insert 2;superscript;swap;operator frac 2",m:"name partial2_x_y;insert \\partial;swap;concat;insert \\partial;rot;concat;swap;insert \\,;swap;concat;concat;insert \\partial;insert 2;superscript;swap;operator frac 2",M:"name partial2_z_x_y;insert \\partial;swap;concat;insert \\partial;rot;concat;swap;insert \\,;swap;concat;concat;swap;insert \\partial;insert 2;superscript;swap;concat;swap;operator frac 2",g:"name gradient;insert \\nabla;swap;concat",d:"name divergence;insert \\nabla;insert \\cdot;concat;swap;concat",c:"name curl;insert \\nabla;insert \\times;concat;swap;concat",l:"name laplacian;insert \\nabla;insert 2;superscript;swap;concat"},infix:{a:"apply_infix",b:"infix \\bullet",c:"infix \\cap",d:"infix \\setminus",g:"infix \\gets",k:"insert \\,;swap;concat;swap;insert \\,;concat;swap;delimiters . . \\vert 2",l:"infix \\parallel",m:"infix \\mapsto",M:"infix \\mp",o:"infix \\circ",O:"stackrel overset",p:"infix \\perp",P:"infix \\pm",s:"infix \\,",t:"infix \\to",u:"infix \\cup",U:"stackrel underset",v:"infix \\vee",w:"infix \\wedge",x:"infix \\times",X:"infix \\otimes","[":"infix \\llcorner","]":"infix \\lrcorner","|":"delimiters . . \\vert 2","=":"infix \\Rightarrow","-":"infix \\ominus","+":"infix \\oplus",".":"infix \\cdot",",":"infix ,"," ":"infix ,\\,",":":"infix :",";":"infix semicolon\\:","%":"infix \\pmod","*":"infix *","\\":"delimiters . . / 2","/":"infix /",">":"infix \\cdots"},relational:{a:"infix \\approx",c:"infix \\cong",e:"infix \\equiv",E:"infix \\iff",g:"infix >",G:"infix \\gg",i:"infix \\in",I:"infix \\notin",l:"infix <",L:"infix \\ll",n:"infix \\ne",p:"infix \\propto",q:"infix =",s:"infix \\subseteq",S:"infix \\subset","=":"infix =","<":"infix <",">":"infix >","[":"infix \\le","]":"infix \\ge",":":"infix \\coloneqq","~":"infix \\sim","|":"infix \\vDash"},symbol:{0:"insert \\varnothing",1:"insert -1",2:"name half_display;insert 1;insert 2;operator frac 2",3:"name half_inline;insert 1;insert 2;infix /",8:"insert \\infty",a:"insert \\forall",c:"insert \\cdot",C:"insert \\bigcap",d:"insert \\partial",e:"insert \\exists",h:"insert \\hslash",i:"insert \\int",I:"insert \\iint",l:"insert \\ell",M:"insert \\mp",o:"insert \\circ",p:"insert \\prod",P:"insert \\pm",q:"insert ?",s:"insert \\sum",t:"insert \\intercal",T:"insert \\triangle",U:"insert \\bigcup",v:"insert \\vee",w:"insert \\wedge",y:"insert \\oint",Y:"insert \\oiint",".":"insert \\dots",">":"insert \\cdots","-":"insert -","+":"insert +","*":"insert \\star","|":"insert |","=":"insert_markdown ---","?":"insert ?","!":"insert !",",":"insert ,",";":"insert semicolon",":":"insert :","`":"insert `","'":"insert_defer"," ":"insert ",ArrowUp:"insert \\uparrow",ArrowDown:"insert \\downarrow"},decoration:{1:"insert -1;superscript",a:"operator overrightarrow",b:"operator mathbb",c:"mode color",d:"insert \\dagger;superscript",D:"insert \\ddagger;superscript",e:"operator bold",f:"prefix \\therefore",F:"prefix \\because",g:"operator mathring",h:"apply_hat hat",H:"apply_hat widehat",k:"operator mathfrak",l:"insert \\parallel;subscript",m:"operator mathtt",M:"prefix \\mp",o:"operator bar",O:"operator overline",p:"insert \\perp;subscript",P:"prefix \\pm",r:"operator mathrm",s:"operator mathsf",t:"prefix \\to",T:"operator widetilde",u:"apply_hat breve",U:"operator utilde",v:"operator vec",V:"apply_hat check",W:"apply_hat widecheck",x:"operator boxed",X:"operator sout",".":"operator dot",'"':"operator ddot"," ":"insert \\,;concat","'":"autoparenthesize;prime","*":"insert *;superscript","~":"apply_hat tilde","=":"prefix \\Rightarrow","-":"prefix -","+":"prefix +","`":"operator grave","/":"operator cancel","\\":"operator bcancel",_:"operator underline"},color:{b:"color blue",g:"color green",h:"color #888",k:"color black",o:"color orange",p:"color purple",r:"color red",y:"color #ff0"},array:{a:"build_align aligned",c:"build_align cases",C:"build_align rcases",d:"dissolve_matrix",e:"name ellipsis_list;build_list ,\\,;insert ,\\,\\dots;concat",E:"insert_matrix_ellipses",g:"build_align gathered",k:"build_substack",m:"build_matrix_row matrix",p:"name plus_list;build_list +;insert +\\cdots;concat",s:"split_matrix",T:"matrix_transpose",v:"build_matrix_row vmatrix",V:"build_matrix_row Vmatrix","|":"stack_matrices",",":"build_list ,"," ":"build_list ,\\,",".":"name ellipsis_list_2;build_list ,\\, ,\\,\\dots,\\,",";":"build_list semicolon\\,","+":"name plus_list_2;insert +;swap;build_infix_list \\cdots ",Enter:"stack_matrices","(":"build_matrix_row pmatrix","[":"build_matrix_row bmatrix","{":"build_matrix_row Bmatrix"},editor:{Tab:"finish_editing","Shift+Enter":"finish_editing","Shift+ArrowDown":"import_item_into_editor",Escape:"cancel_editing"},script:{"[alpha]":"name mathscr_letter;self_insert;to_case uppercase;operator mathscr","&":"insert \\&"},calligraphic:{"[alpha]":"name mathcal_letter;self_insert;to_case uppercase;operator mathcal","%":"insert \\%"},lowercase_greek:{a:"insert \\alpha",b:"insert \\beta",c:"insert \\chi",d:"insert \\delta",e:"insert \\epsilon",f:"insert \\phi",g:"insert \\gamma",h:"insert \\eta",i:"insert \\iota",j:"insert \\varphi",k:"insert \\kappa",l:"insert \\lambda",m:"insert \\mu",n:"insert \\nu",o:"insert \\omega",p:"insert \\pi",q:"insert \\vartheta",r:"insert \\rho",s:"insert \\sigma",t:"insert \\tau",u:"insert \\upsilon",v:"insert \\theta",w:"insert \\omega",x:"insert \\xi",y:"insert \\psi",z:"insert \\zeta",";":"infix semicolon"},uppercase_greek:{d:"insert \\Delta",e:"insert \\varepsilon",f:"insert \\Phi",g:"insert \\Gamma",l:"insert \\Lambda",m:"insert \\varpi",o:"insert \\Omega",p:"insert \\Pi",q:"insert \\vartheta",r:"insert \\varrho",s:"insert \\Sigma",t:"insert \\varsigma",u:"insert \\Upsilon",v:"insert \\Theta",w:"insert \\Omega",x:"insert \\Xi",y:"insert \\Psi",n:"insert \\nabla",D:"insert \\Delta",E:"insert \\varepsilon",F:"insert \\Phi",G:"insert \\Gamma",L:"insert \\Lambda",M:"insert \\varpi",O:"insert \\Omega",P:"insert \\Pi",Q:"insert \\vartheta",R:"insert \\varrho",S:"insert \\Sigma",T:"insert \\varsigma",U:"insert \\Upsilon",V:"insert \\Theta",W:"insert \\Omega",X:"insert \\Xi",Y:"insert \\Psi",N:"insert \\nabla",":":"infix :"}},k=n(20),g=n.n(k),b=n(18),w=n.n(b),j=function(){function e(){Object(u.a)(this,e),this.bindings=y}return Object(l.a)(e,[{key:"lookup_binding",value:function(e,t){var n=this.bindings[e];return n?n[t]?n[t]:n["[alpha]"]&&/^[a-zA-Z]$/.test(t)?n["[alpha]"]:n["[digit]"]&&/^[0-9]$/.test(t)?n["[digit]"]:n["[alnum]"]&&/^[a-zA-Z0-9]$/.test(t)?n["[alnum]"]:n.default?n.default:"base"===e||"editor"===e?null:"cancel":null}}]),e}(),O=function(){function e(){Object(u.a)(this,e),this.current_keymap=new j,this.selected_theme="default",this.last_opened_filename=null,this.popup_mode=null,this.layout=this.default_layout()}return Object(l.a)(e,[{key:"default_layout",value:function(){return{zoom_factor:0,stack_rightalign_math:!1,document_rightalign_math:!1,stack_side:"left",stack_split:50}}},{key:"apply_layout_to_dom",value:function(e,t,n){var i=this.layout;n.style.display=this.popup_mode?"block":"none";var r=document.getElementById("root"),s=Math.round(100*Math.pow(1.05,i.zoom_factor||0));r.style.fontSize=s+"%";var a=this._split_rectangle({x:0,y:0,w:100,h:100},i.stack_side,i.stack_split),o=Object(c.a)(a,2),u=o[0],l=o[1];this._apply_bounds(e,u),this._apply_bounds(t,l)}},{key:"_split_rectangle",value:function(e,t,n){var i=Math.round(n*e.w/100),r=e.w-i,s=Math.round(n*e.h/100),a=e.h-s;switch(t){case"left":return[{x:e.x,y:e.y,w:i,h:e.h},{x:e.x+i,y:e.y,w:r,h:e.h}];case"right":return[{x:e.x+r,y:e.y,w:i,h:e.h},{x:e.x,y:e.y,w:r,h:e.h}];case"top":return[{x:e.x,y:e.y,w:e.w,h:s},{x:e.x,y:e.y+s,w:e.w,h:a}];case"bottom":return[{x:e.x,y:e.y+a,w:e.w,h:s},{x:e.x,y:e.y,w:e.w,h:a}];default:return[e,e]}}},{key:"_apply_bounds",value:function(e,t){e.style.left=t.x+"%",e.style.top=t.y+"%",e.style.width=t.w+"%",e.style.height=t.h+"%"}},{key:"save",value:function(){var e=JSON.stringify(this.to_json());localStorage.setItem("settings",e)}},{key:"to_json",value:function(){var t=this,n={};return e.saved_keys.forEach((function(e){n[e]=t[e]})),n}}],[{key:"load_from_local_storage",value:function(){var t=localStorage.getItem("settings");return t?e.from_json(JSON.parse(t)):new e}},{key:"from_json",value:function(t){var n=new e;return e.saved_keys.forEach((function(e){n[e]=t[e]})),n}}]),e}();O.saved_keys=["selected_theme","last_opened_filename","popup_mode","layout"];var E=function(){function e(){Object(u.a)(this,e),this.tokens=[],this.last_token_type=null}return Object(l.a)(e,[{key:"emit_token",value:function(e,t){e.length>0&&(this.tokens.push(e),this.last_token_type=t)}},{key:"expr",value:function(e){e.emit_latex(this)}},{key:"grouped_expr",value:function(e,t){var n=this;this.grouped((function(){return n.expr(e)}),t)}},{key:"grouped",value:function(e,t){var n=[this.tokens,this.last_token_type],i=n[0],r=n[1],s=[[],null];this.tokens=s[0],this.last_token_type=s[1],e();var a=[this.tokens,this.last_token_type],o=a[0],c=a[1];this.tokens=i,this.last_token_type=r,"force"===t||0===o.length||o.length>1?(this.text("{"),this.text(o.join("")),this.text("}")):"text"===c?1===o[0].length?this.text(o[0]):(this.text("{"),this.text(o[0]),this.text("}")):"force_commands"===t?(this.text("{"),this.emit_token(o[0],"command"),this.text("}")):this.emit_token(o[0],"command")}},{key:"text",value:function(e){if("command"===this.last_token_type){var t=this.tokens[this.tokens.length-1];this._is_latex_identifier_char(t.charAt(t.length-1))&&this._is_latex_identifier_char(e.charAt(0))&&this.emit_token(" ","text")}this.emit_token(e,"text")}},{key:"_is_latex_identifier_char",value:function(e){return/^[a-zA-Z]$/.test(e)}},{key:"command",value:function(e,t){t&&(e=e+"["+t+"]"),this.emit_token("\\"+e,"command")}},{key:"text_or_command",value:function(e){e.startsWith("\\")?this.command(e.slice(1)):this.text(e)}},{key:"begin_environment",value:function(e){this.text("\\begin{"+e+"}\n")}},{key:"end_environment",value:function(e){this.text("\n\\end{"+e+"}\n")}},{key:"align_separator",value:function(){this.text(" & ")}},{key:"row_separator",value:function(){this.text("\\\\[0.1em]\n")}},{key:"finished_string",value:function(){return this.tokens.join("")}}]),e}(),C=function(){function e(t,n){Object(u.a)(this,e),this.stack=t||this._default_stack(),this.document=n||new F([],0),this.is_dirty=!1}return Object(l.a)(e,[{key:"_default_stack",value:function(){var e=new H("Welcome to the editor.  Press [**?**] to toggle help.");return new K([e])}},{key:"same_as",value:function(e){return this.stack===e.stack&&this.document===e.document}},{key:"to_json",value:function(){return{stack:this.stack.to_json(),document:this.document.to_json(),format:1}}}],[{key:"from_json",value:function(t){return new e(K.from_json(t.stack),F.from_json(t.document))}}]),e}(),S=function(){function e(){Object(u.a)(this,e),this.state_stack=[],this.max_stack_depth=100,this.undo_count=0}return Object(l.a)(e,[{key:"clear",value:function(e){this.state_stack=[e],this.undo_count=0}},{key:"push_state",value:function(e){return this.state_stack.length>this.undo_count&&this.state_stack[this.state_stack.length-this.undo_count-1].same_as(e)?null:(this.undo_count>0&&(this.state_stack=this.state_stack.slice(0,this.state_stack.length-this.undo_count),this.undo_count=0),this.state_stack.push(e),this.state_stack.length>this.max_stack_depth&&(this.state_stack=this.state_stack.slice(this.state_stack.length-this.max_stack_depth)),e)}},{key:"undo_state",value:function(){return this.state_stack.length-1>this.undo_count?(this.undo_count++,this.state_stack[this.state_stack.length-this.undo_count-1]):null}},{key:"redo_state",value:function(){return this.undo_count>0?(this.undo_count--,this.state_stack[this.state_stack.length-this.undo_count-1]):null}}]),e}(),z=function(){function e(){Object(u.a)(this,e),this.open_request=null,this.database=null}return Object(l.a)(e,[{key:"open_database",value:function(e){indexedDB&&(this.on_open_success=e,this.open_request=indexedDB.open("rpnlatex",1),this.open_request.onupgradeneeded=this.handle_upgrade_database.bind(this),this.open_request.onsuccess=this.handle_open_success.bind(this),this.open_request.onerror=this.handle_open_error.bind(this))}},{key:"handle_upgrade_database",value:function(e){switch(this.database=this.open_request.result,e.oldVersion){case 0:this.build_initial_schema()}}},{key:"build_initial_schema",value:function(){this.database.createObjectStore("documents",{keyPath:"filename"}),this.database.createObjectStore("documents_metadata",{keyPath:"filename"})}},{key:"handle_open_error",value:function(e){this.open_request=null}},{key:"handle_open_success",value:function(e){this.database=this.open_request.result,this.open_request=null,this.database.onversionchange=function(){this.database.close(),this.database=null,alert("Warning: database is outdated, please reload the page.")},this.on_open_success&&this.on_open_success()}},{key:"create_transaction",value:function(e){return this.database.transaction(["documents","documents_metadata"],e?"readwrite":"readonly")}},{key:"sanitize_filename",value:function(e){var t=e.replaceAll(/[^a-zA-Z0-9_ ]/g,"").trim();return 0===t.length||t.length>200?null:t}},{key:"load_state",value:function(e,t,n){if(!this.database)return n();var i=this.create_transaction(!1).objectStore("documents").get(e);i.onsuccess=function(){if(i.result){var r=C.from_json(i.result);t(e,r)}else n(e,"???")},i.onerror=function(){n(e,"???")}}},{key:"save_state",value:function(e,t,n,i){if(!this.database)return i();var r=e.to_json();r.filename=t;var s={filename:t,filesize:JSON.stringify(r).length,description:"",stack_item_count:e.stack.depth(),document_item_count:e.document.items.length,timestamp:new Date},a=this.create_transaction(!0);a.objectStore("documents").put(r),a.objectStore("documents_metadata").put(s),n&&(a.oncomplete=n),i&&(a.onabort=i)}},{key:"delete_state",value:function(e,t,n){if(!this.database)return n();var i=this.create_transaction(!0);i.objectStore("documents").delete(e),i.objectStore("documents_metadata").delete(e),t&&(i.oncomplete=t),n&&(i.onabort=n)}},{key:"fetch_file_list",value:function(e,t){if(!this.database)return t();var n=this.create_transaction(!1).objectStore("documents_metadata").getAll();n.onsuccess=function(){n.result.forEach((function(e){var t=Date.parse(e.timestamp);e.timestamp=t?new Date(t):null})),e(n.result)},n.onerror=t}},{key:"fetch_all_documents",value:function(e,t,n){if(!this.database)return n();var i=this.create_transaction(!1).objectStore("documents").openCursor();i.onsuccess=function(n){var i=n.target.result;i?(e(i.value),i.continue()):t()},i.onerror=n}}]),e}(),N=function(){function e(){Object(u.a)(this,e),this.state="idle",this.document_storage=null,this.import_count=0,this.failed_count=0,this.error_message=null,this.download_url=null,this.import_result_string=null,this.file_list_needs_update=!1,this.onstatechange=null}return Object(l.a)(e,[{key:"textual_state",value:function(){switch(this.state){case"idle":return this.download_url?"Download Ready":"Ready for import or export";case"error":return"Error: "+this.error_message;case"loading":return"Extacting database...";case"zipping":return"Compressing files...";case"uploading":return"Uploading data...";case"importing":return"Importing documents: "+this.import_count+" so far";default:return"???"}}},{key:"download_available",value:function(){return"idle"===this.state&&this.download_url}},{key:"generate_download_filename",value:function(){var e=new Date;return["rpnlatex_",e.getFullYear().toString(),"_",e.toLocaleString("default",{month:"short"}).toLowerCase(),"_",e.getDate().toString().padStart(2,"0"),".zip"].join("")}},{key:"change_state",value:function(e){this.state=e,this.onstatechange&&this.onstatechange(this)}},{key:"start_exporting",value:function(){var e=this,t=this.document_storage;this.zip=new w.a,t.fetch_all_documents((function(t){return e.add_document_json_to_zip(t)}),(function(){return e.start_compressing()}),(function(){e.error_message="Unable to export the document database.",e.change_state("error")})),this.change_state("loading")}},{key:"add_document_json_to_zip",value:function(e){this.zip.file(e.filename+".json",JSON.stringify(e))}},{key:"start_compressing",value:function(){var e=this;this.change_state("zipping"),this.zip.generateAsync({type:"blob"}).then((function(t){e.finished_compressing(t)}))}},{key:"clear_download_url",value:function(){this.download_url&&(URL.revokeObjectURL(this.download_url),this.download_url=null)}},{key:"finished_compressing",value:function(e){this.clear_download_url(),this.download_url=URL.createObjectURL(e),this.zip=null,this.change_state("idle")}},{key:"start_importing",value:function(e){var t=this;if(this.clear_download_url(),this.import_result_string=null,"application/zip"===e.type){this.change_state("uploading");var n=new FileReader;n.addEventListener("load",(function(e){return t.process_uploaded_data(e.target.result)})),n.readAsArrayBuffer(e)}else alert("Import files must be zip archives.")}},{key:"process_uploaded_data",value:function(e){var t=this;this.import_count=0,this.error_message=null,this.change_state("importing"),w.a.loadAsync(e).then((function(e){var n=[],i=function(i){var r=e.files[i];i.endsWith(".json")?n.push(r.async("string").then((function(e){return t.import_file(r.name.slice(0,r.name.length-5),e)}))):(t.error_message="Invalid filename in archive: "+i,t.failed_count++)};for(var r in e.files)i(r);Promise.all(n).then((function(){t.failed_count>0?t.import_result_string="Errors encountered: "+t.error_message:t.import_result_string="Successfully imported "+t.import_count+" document"+(1===t.import_count?"":"s"),t.change_state("idle"),t.file_list_needs_update=!0}))}))}},{key:"import_file",value:function(e,t){var n,i,r=this.document_storage;try{n=JSON.parse(t),i=C.from_json(n)}catch(s){return this.error_message="Invalid document found in zip file: "+e,void this.failed_count++}r.save_state(i,e),this.import_count++,this.change_state("importing")}}]),e}(),q=function(){function e(t,n,i){Object(u.a)(this,e),this.file_list=t,this.selected_filename=n,this.current_filename=i,this.unavailable=!1}return Object(l.a)(e,[{key:"sort_file_list",value:function(e,t){this.file_list.sort((function(n,i){var r=n[e],s=i[e];return(t?1:-1)*(r===s?0:r<s?-1:1)}))}},{key:"generate_unused_filename",value:function(e){var t=this;if(this.unavailable||!this.file_list)return e;e=e.replace(/_\d+$/,"");for(var n=function(n){var i=e+"_"+n;if(!t.file_list.some((function(e){return e.filename===i})))return{v:i}},i=1;i<1e3;i++){var r=n(i);if("object"===typeof r)return r.v}return e+"_toomany"}},{key:"find_adjacent_filename",value:function(e,t){if(this.unavailable||!this.file_list)return null;var n=null,i=this.file_list;return i.forEach((function(r,s){if(r.filename===e){var a=s+t;a<0&&(a=0),a>=i.length&&(a=i.length-1),n=i[a].filename}})),!n&&i.length>0&&(n=i[0].filename),n}}]),e}(),I=function(){function e(){Object(u.a)(this,e)}return Object(l.a)(e,[{key:"expr_type",value:function(){return"???"}},{key:"to_latex",value:function(){var e=new E;return this.emit_latex(e),e.finished_string()}},{key:"emit_latex",value:function(e){e.text("INVALID")}},{key:"json_keys",value:function(){return[]}},{key:"to_json",value:function(){var t=this,n={expr_type:this.expr_type()};return this.json_keys().forEach((function(i){var r,s=t[i];r=null===s||void 0===s?null:"object"===typeof s&&s instanceof e?s.to_json():"object"===typeof s?s.map((function(e){return e.to_json()})):s,n[i]=r})),n}},{key:"to_text",value:function(){return"$$\n"+this.to_latex()+"\n$$"}},{key:"visit",value:function(e){e(this)}},{key:"find_defer",value:function(){var e=null;return this.visit((function(t){"defer"!==t.expr_type()||e||(e=t)})),e}},{key:"substitute_expr",value:function(e,t){return this===e?t:this}}],[{key:"from_json",value:function(e){switch(e.expr_type){case"command":return new T(e.command_name,this._list(e.operand_exprs),e.options);case"prefix":return new A(this._expr(e.base_expr),this._expr(e.prefix_expr));case"infix":return new D(this._expr(e.operator_expr),this._expr(e.left_expr),this._expr(e.right_expr));case"defer":return new U;case"text":return new L(e.text);case"sequence":return new B(this._list(e.exprs));case"delimiter":return new $(e.left_type,e.right_type,e.middle_type,this._list(e.inner_exprs));case"subscriptsuperscript":return new R(this._expr(e.base_expr),this._expr(e.subscript_expr),this._expr(e.superscript_expr));case"array":return new W(e.array_type,e.row_count,e.column_count,this._list2d(e.element_exprs));case"accumulator":return new M(e.accumulator_type,e.text);default:return new L("invalid expr type "+e.expr_type)}}},{key:"_expr",value:function(t){return t?e.from_json(t):null}},{key:"_list",value:function(t){return t.map((function(t){return e.from_json(t)}))}},{key:"_list2d",value:function(t){return t.map((function(t){return e._list(t)}))}},{key:"combine_pair",value:function(e,t){var n=e.expr_type(),i=t.expr_type();return"sequence"===n&&"sequence"===i?new B(e.exprs.concat(t.exprs)):"text"===n&&"text"===i?new L(e.text+t.text):"sequence"===n&&"text"===i&&"text"===e.exprs[e.exprs.length-1].expr_type()?new B(e.exprs.slice(0,-1).concat([new L(e.exprs[e.exprs.length-1].text+t.text)])):"text"===n&&"text"===i&&"text"===t.exprs[0].expr_type()?new B([new L(e.text+t.exprs[0].text)].concat(t.exprs.slice(1))):new B([e,t])}},{key:"combine_exprs",value:function(t){switch(t.length){case 0:return null;case 1:return t[0];case 2:return e.combine_pair(t[0],t[1]);default:return e.combine_pair(t[0],e.combine_exprs(t.slice(1)))}}}]),e}(),T=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e,i,r){var s;if(Object(u.a)(this,n),s=t.call(this),e.endsWith("]")){var a=e.indexOf("[");s.command_name=e.slice(0,a),s.options=e.slice(a+1,e.length-1)}else s.command_name=e,s.options=void 0===r?null:r;return s.operand_exprs=i||[],s}return Object(l.a)(n,[{key:"operand_count",value:function(){return this.operand_exprs.length}},{key:"expr_type",value:function(){return"command"}},{key:"json_keys",value:function(){return["command_name","operand_exprs","options"]}},{key:"emit_latex",value:function(e){e.command(this.command_name,this.options),this.operand_exprs.forEach((function(t){return e.grouped_expr(t,"force")}))}},{key:"visit",value:function(e){e(this),this.operand_exprs.forEach((function(t){return t.visit(e)}))}},{key:"substitute_expr",value:function(e,t){return this===e?t:new n(this.command_name,this.operand_exprs.map((function(n){return n.substitute_expr(e,t)})),this.options)}}]),n}(I),A=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e,i){var r;return Object(u.a)(this,n),(r=t.call(this)).base_expr=e,r.prefix_expr=i,r}return Object(l.a)(n,[{key:"expr_type",value:function(){return"prefix"}},{key:"json_keys",value:function(){return["base_expr","prefix_expr"]}},{key:"emit_latex",value:function(e){e.expr(this.prefix_expr),e.expr(this.base_expr)}},{key:"visit",value:function(e){this.prefix_expr.visit(e),e(this),this.base_expr.visit(e)}},{key:"substitute_expr",value:function(e,t){return this===e?t:new n(this.base_expr.substitute_expr(e,t),this.prefix_expr.substitute_expr(e,t))}}]),n}(I),D=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e,i,r){var s;return Object(u.a)(this,n),(s=t.call(this)).operator_expr=e,s.left_expr=i,s.right_expr=r,s}return Object(l.a)(n,[{key:"expr_type",value:function(){return"infix"}},{key:"json_keys",value:function(){return["operator_expr","left_expr","right_expr"]}},{key:"operator_text",value:function(){var e=this.operator_expr;return"command"===e.expr_type()&&0===e.operand_count()?e.command_name:"text"===e.expr_type()?e.text:null}},{key:"needs_autoparenthesization",value:function(){var e=this.operator_text();return e&&("+"===e||"-"===e)}},{key:"emit_latex",value:function(e){this.left_expr&&e.expr(this.left_expr),e.expr(this.operator_expr),this.right_expr&&e.expr(this.right_expr)}},{key:"visit",value:function(e){this.left_expr&&this.left_expr.visit(e),e(this),this.right_expr&&this.right_expr.visit(e)}},{key:"substitute_expr",value:function(e,t){return this===e?t:new n(this.operator_expr.substitute_expr(e,t),this.left_expr.substitute_expr(e,t),this.right_expr.substitute_expr(e,t))}}]),n}(I),U=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"expr_type",value:function(){return"defer"}},{key:"json_keys",value:function(){return[]}},{key:"emit_latex",value:function(e){var t=new T("htmlClass",[new L("defer_expr"),new T("circledast")]);e.expr(t)}}]),n}(I),L=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e){var i;return Object(u.a)(this,n),(i=t.call(this)).text=e,i}return Object(l.a)(n,[{key:"expr_type",value:function(){return"text"}},{key:"json_keys",value:function(){return["text"]}},{key:"emit_latex",value:function(e){e.text(this.text)}}]),n}(I),B=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e){var i;return Object(u.a)(this,n),(i=t.call(this)).exprs=e,i}return Object(l.a)(n,[{key:"expr_type",value:function(){return"sequence"}},{key:"json_keys",value:function(){return["exprs"]}},{key:"emit_latex",value:function(e){this.exprs.forEach((function(t){return e.expr(t)}))}},{key:"visit",value:function(e){e(this),this.exprs.forEach((function(t){return t.visit(e)}))}},{key:"substitute_expr",value:function(e,t){return this===e?t:new n(this.exprs.map((function(n){return n.substitute_expr(e,t)})))}}]),n}(I),$=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e,i,r,s){var a;return Object(u.a)(this,n),(a=t.call(this)).left_type=e,a.right_type=i,a.middle_type=r||null,a.inner_exprs=s||[],a}return Object(l.a)(n,[{key:"expr_type",value:function(){return"delimiter"}},{key:"json_keys",value:function(){return["left_type","right_type","middle_type","inner_exprs"]}},{key:"emit_latex",value:function(e){var t=this;e.command("left"),e.text_or_command(this.left_type),this.inner_exprs.forEach((function(n,i){i>0&&(e.command("middle"),e.text_or_command(t.middle_type||"|")),e.expr(n)})),e.command("right"),e.text_or_command(this.right_type)}},{key:"visit",value:function(e){e(this),this.inner_exprs.forEach((function(t){return t.visit(e)}))}},{key:"substitute_expr",value:function(e,t){return this===e?t:new n(this.left_type,this.right_type,this.middle_type,this.inner_exprs.map((function(n){return n.substitute_expr(e,t)})))}}],[{key:"parenthesize",value:function(e){return new n("(",")",null,[e])}},{key:"autoparenthesize",value:function(e){return"infix"===e.expr_type()&&e.needs_autoparenthesization()?n.parenthesize(e):e}}]),n}(I),R=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e,i,r){var s;return Object(u.a)(this,n),(s=t.call(this)).base_expr=e,s.subscript_expr=i,s.superscript_expr=r,s}return Object(l.a)(n,[{key:"expr_type",value:function(){return"subscriptsuperscript"}},{key:"json_keys",value:function(){return["base_expr","subscript_expr","superscript_expr"]}},{key:"emit_latex",value:function(e){"command"===this.base_expr.expr_type()?e.expr(this.base_expr):e.grouped_expr(this.base_expr),this.subscript_expr&&(e.text("_"),e.grouped_expr(this.subscript_expr,"force_commands")),this.superscript_expr&&(e.text("^"),e.grouped_expr(this.superscript_expr,"force_commands"))}},{key:"visit",value:function(e){e(this),this.base_expr.visit(e),this.subscript_expr&&this.subscript_expr.visit(e),this.superscript_expr&&this.superscript_expr.visit(e)}},{key:"substitute_expr",value:function(e,t){return this===e?t:new n(this.base_expr.substitute_expr(e,t),this.subscript_expr?this.subscript_expr.substitute_expr(e,t):null,this.superscript_expr?this.superscript_expr.substitute_expr(e,t):null)}}]),n}(I),W=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e,i,r,s){var a;return Object(u.a)(this,n),(a=t.call(this)).array_type=e,a.row_count=i,a.column_count=r,a.element_exprs=s,a}return Object(l.a)(n,[{key:"expr_type",value:function(){return"array"}},{key:"json_keys",value:function(){return["array_type","row_count","column_count"]}},{key:"is_matrix",value:function(){var e=this.array_type;return"bmatrix"===e||"Bmatrix"===e||"matrix"===e||"pmatrix"===e||"vmatrix"===e||"Vmatrix"===e}},{key:"to_json",value:function(){var e=Object(v.a)(Object(x.a)(n.prototype),"to_json",this).call(this);return e.element_exprs=this.element_exprs.map((function(e){return e.map((function(e){return e.to_json()}))})),e}},{key:"with_ellipses",value:function(){var e=this;if(this.row_count<=1||this.column_count<=1)return this;for(var t=function(e){return new L(e)},i=this.element_exprs.map((function(n,i){return[].concat(Object(o.a)(n.slice(0,-1)),[t(0===i||i===e.row_count-1?"\\cdots":""),n[e.column_count-1]])})),r=[t("\\vdots")],s=0;s<this.column_count-2;s++)r.push(t(""));return r.push(t("\\ddots")),r.push(t("\\vdots")),i.splice(this.row_count-1,0,r),new n(this.array_type,this.row_count+1,this.column_count+1,i)}},{key:"transposed",value:function(){for(var e=this,t=[],i=function(n){t.push(e.element_exprs.map((function(t){return e._transpose_cell(t[n])})))},r=0;r<this.column_count;r++)i(r);return new n(this.array_type,this.column_count,this.row_count,t)}},{key:"_transpose_cell",value:function(e){if("text"===e.expr_type())switch(e.text){case"\\vdots":return new L("\\cdots");case"\\cdots":return new L("\\vdots")}return e}},{key:"split_rows",value:function(){var e=this;return this.element_exprs.map((function(t){return new n(e.array_type,1,e.column_count,[t])}))}},{key:"emit_latex",value:function(e){e.begin_environment(this.array_type),this.element_exprs.forEach((function(t,n){n>0&&e.row_separator(),t.forEach((function(t,n){n>0&&e.align_separator(),t&&e.expr(t)}))})),e.end_environment(this.array_type)}},{key:"visit",value:function(e){e(this),this.element_exprs.forEach((function(t){return t.forEach((function(t){return t.visit(e)}))}))}},{key:"substitute_expr",value:function(e,t){if(this===e)return t;var i=this.element_exprs.map((function(n){return n.map((function(n){return n.substitute_expr(e,t)}))}));return new n(this.array_type,this.row_count,this.column_count,i)}}],[{key:"split_elements",value:function(e,t){return e.map((function(e){return n._split_expr(e,t)}))}},{key:"_split_expr",value:function(e,t){switch(t){case"none":return[e];case"infix":return"infix"===e.expr_type()?[e.left_expr,new D(e.operator_expr,null,e.right_expr)]:[e,null];case"colon":return"infix"===e.expr_type()&&":"===e.operator_text()?[e.left_expr,e.right_expr]:[e,null];default:return[e]}}}]),n}(I),M=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e,i){var r;return Object(u.a)(this,n),(r=t.call(this)).accumulator_type=e,r.text=i,r}return Object(l.a)(n,[{key:"expr_type",value:function(){return"accumulator"}},{key:"json_keys",value:function(){return["accumulator_type","text"]}},{key:"with_extra_character",value:function(e){return new n(this.accumulator_type,this.text+e)}},{key:"without_last_character",value:function(){return new n(this.accumulator_type,this.text.slice(0,-1))}},{key:"is_valid_character",value:function(e){if("latex"===this.accumulator_type){var t=/^[a-zA-Z]$/;return 0===this.text.length&&1===e.length||!(1===this.text.length&&!t.test(this.text))&&t.test(e)}return 1===e.length}},{key:"is_empty",value:function(){return 0===this.text.length}},{key:"finished_expr",value:function(){var e=this.text.trim();if(0===e.length)return null;switch(this.accumulator_type){case"latex":return new T(e);case"text":return new L(this._latex_escape(e));default:return null}}},{key:"_latex_escape",value:function(e){var t={_:"\\_","^":"\\wedge","%":"\\%","'":"\\prime","`":"\\backprime"," ":"\\,",$:"\\$","&":"\\&","#":"\\#","}":"\\}","{":"\\{","~":"\\sim","\\":"\\backslash"};return e.replaceAll(/[_^%'` $&#}{~\\]/g,(function(e){return t[e]}))}},{key:"emit_latex",value:function(e){e.expr(this._to_display_expr())}},{key:"_to_display_expr",value:function(){switch(this.accumulator_type){case"latex":return new B([new T("backslash"),new T("mathrm",[this.is_empty()?new T("thinspace"):new L(this._latex_escape(this.text))])]);case"text":return new T("boxed",[new B([new T("vphantom",[new L("I")]),this.is_empty()?new T(","):new L(this._latex_escape(this.text))])]);default:return new L("???")}}}]),n}(I),P=function(){function e(){Object(u.a)(this,e),this.serial=e.next_serial()}return Object(l.a)(e,[{key:"react_key",value:function(e){return e+"_"+this.serial}},{key:"item_type",value:function(){return"???"}},{key:"to_json",value:function(){return{}}},{key:"to_text",value:function(){return"???"}}],[{key:"next_serial",value:function(){return e.serial_number++}},{key:"from_json",value:function(e){switch(e.item_type){case"expr":return new V(I.from_json(e.expr),e.tag_expr?I.from_json(e.tag_expr):null);case"markdown":return new H(e.source_text);default:return new H("invalid item type "+e.item_type)}}},{key:"from_string",value:function(e){if((e=(e||"").trim()).startsWith("$$")&&e.slice(2).endsWith("$$")){var t=e.slice(2,-2);return new V(new L(t))}return new H(e)}}]),e}();P.serial_number=1;var V=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e,i){var r;return Object(u.a)(this,n),(r=t.call(this)).expr=e,r.tag_expr=i,r}return Object(l.a)(n,[{key:"item_type",value:function(){return"expr"}},{key:"to_json",value:function(){var e={item_type:"expr",expr:this.expr.to_json()};return this.tag_expr&&(e.tag_expr=this.tag_expr.to_json()),e}},{key:"to_text",value:function(){return this.expr.to_text()}}]),n}(P),H=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e){var i;return Object(u.a)(this,n),(i=t.call(this)).source_text=e,i.rendered_html=i.render_markdown(i.source_text),i}return Object(l.a)(n,[{key:"is_empty",value:function(){return 0===this.source_text.trim().length}},{key:"render_markdown",value:function(e){return e=e.replaceAll("$","`"),g.a.parse(e)}},{key:"item_type",value:function(){return"markdown"}},{key:"to_json",value:function(){return{item_type:"markdown",source_text:this.source_text}}},{key:"to_text",value:function(){return this.source_text}}]),n}(P),K=function(){function e(t){Object(u.a)(this,e),this.items=t}return Object(l.a)(e,[{key:"depth",value:function(){return this.items.length}},{key:"check",value:function(e){return this.depth()>=e}},{key:"check_exprs",value:function(e){if(!this.check(e))return!1;for(var t=0;t<e;t++)if("expr"!==this.items[this.items.length-1-t].item_type())return!1;return!0}},{key:"peek",value:function(e){return this.check(1)||this.underflow(),this.items[this.items.length-e]}},{key:"pop",value:function(e){return void 0===e&&(e=1),this.check(e)||this.underflow(),this._unchecked_pop(e)}},{key:"pop_exprs",value:function(e){this.check(e)||this.underflow(),this.check_exprs(e)||this.type_error();var t=this._unchecked_pop(e),n=Object(f.a)(t),i=n[0],r=n.slice(1);return[i].concat(Object(o.a)(r.map((function(e){return e.expr}))))}},{key:"pop_positive_integer",value:function(){var e=this.pop_exprs(1),t=Object(c.a)(e,2),n=t[0],i=t[1];if("text"===i.expr_type()){var r=parseInt(i.text);if(r>=1)return[n,r]}this.type_error()}},{key:"pop_matrices",value:function(e){var t=this.pop_exprs(e),n=Object(f.a)(t),i=n[0],r=n.slice(1);if(r.every((function(e){return"array"===e.expr_type()&&e.is_matrix()})))return[i].concat(Object(o.a)(r));this.type_error()}},{key:"_unchecked_pop",value:function(t){return[new e(this.items.slice(0,-t))].concat(this.items.slice(-t))}},{key:"push_all",value:function(t){if(!t.every((function(e){return e instanceof P})))throw new Error("pushing invalid item onto stack");return new e(this.items.concat(t))}},{key:"push_all_exprs",value:function(e){return this.push_all(e.map((function(e){return new V(e)})))}},{key:"push",value:function(e){return this.push_all([e])}},{key:"push_expr",value:function(e){return this.push_all_exprs([e])}},{key:"underflow",value:function(){throw new Error("stack_underflow")}},{key:"type_error",value:function(){throw new Error("stack_type_error")}},{key:"to_json",value:function(){return{object_type:"stack",items:this.items.map((function(e){return e.to_json()}))}}}],[{key:"from_json",value:function(t){return new e(t.items.map((function(e){return P.from_json(e)})))}}]),e}(),F=function(){function e(t,n){Object(u.a)(this,e),this.items=t||[],this.selection_index=n}return Object(l.a)(e,[{key:"selected_item",value:function(){return this.selection_index>0?this.items[this.selection_index-1]:null}},{key:"insert_item",value:function(t){var n=this.selection_index;return new e(this.items.slice(0,n).concat([t],this.items.slice(n)),n+1)}},{key:"delete_selection",value:function(){var t=this.selection_index;return t>0?new e(this.items.slice(0,t-1).concat(this.items.slice(t)),t-1):null}},{key:"move_selection_by",value:function(t){var n=this.selection_index+t;return n<0&&(n=0),n>this.items.length&&(n=this.items.length),new e(this.items,n)}},{key:"shift_selection_by",value:function(e){var t=this.selected_item();return!t||this.selection_index+e<=0||this.selection_index+e>this.items.length?null:this.delete_selection().move_selection_by(e).insert_item(t)}},{key:"to_json",value:function(){return{object_type:"document",items:this.items.map((function(e){return e.to_json()})),selection_index:this.selection_index}}},{key:"to_text",value:function(){return this.items.map((function(e){return e.to_text()})).join("\n\n")}}],[{key:"from_json",value:function(t){return new e(t.items.map((function(e){return P.from_json(e)})),t.selection_index||0)}}]),e}(),J=function(){function e(t,n){Object(u.a)(this,e),this.app_component=t,this.mode="base",this.new_mode=null,this.new_document=null,this.files_changed=!1,this.file_saved=!1,this.settings=n,this.notification_text=null,this.perform_undo_or_redo=null,this.minieditor={active:!1},this.custom_delimiters={}}return Object(l.a)(e,[{key:"handle_key",value:function(e,t){if("Shift"===t||"Alt"===t||"Control"===t)return[!1,e];e.stack.depth()>0&&"expr"===e.stack.peek(1).item_type()&&"accumulator"===e.stack.peek(1).expr.expr_type()&&(this.mode="accumulate");var n=this.settings.popup_mode||this.mode,i=this.settings.current_keymap.lookup_binding(n,t);return i?(this.last_keypress=t,[!0,this.process_command(i,e)||e]):[!1,e]}},{key:"process_command",value:function(e,t){var n=e.split(";").map((function(e){return e.split(" ").map((function(e){return e.replaceAll("semicolon",";")}))}));return this.process_command_batch(n,t)}},{key:"process_command_batch",value:function(e,t){this.perform_undo_or_redo=null;for(var n=0;n<e.length;n++){var i=Object(f.a)(e[n]),r=i[0],s=i.slice(1),a=this["do_"+r];if(!a)return null;try{this.app_state=t,this.new_mode=null,this.new_document=null,this.files_changed=!1,this.file_saved=!1,this.notification_text=null;var c=a.bind(this).apply(void 0,[t.stack].concat(Object(o.a)(s))),u=new C(c||t.stack,this.new_document||t.document);u.is_dirty=t.is_dirty||!u.same_as(t),this.file_saved&&(u.is_dirty=!1),t=u,this.mode=this.new_mode||"base"}catch(l){if("stack_underflow"===l.message||"stack_type_error"===l.message)return this.error_flash_stack(),this.perform_undo_or_redo=null,this.mode="base",null;throw l}finally{this.app_state=null,this.new_document=null}}return t}},{key:"switch_to_mode",value:function(e){this.new_mode=e}},{key:"error_flash_element",value:function(e){e.classList.remove("errorflash"),e.offsetWidth,e.classList.add("errorflash")}},{key:"error_flash_stack",value:function(){return this.error_flash_element(document.getElementById("stack_panel"))}},{key:"error_flash_document",value:function(){return this.error_flash_element(document.getElementById("document_panel"))}},{key:"clear_all_flashes",value:function(){for(var e=["stack_panel","document_panel"],t=0;t<e.length;t++){document.getElementById(e[t]).classList.remove("errorflash")}}},{key:"notify",value:function(e){this.notification_text=e}},{key:"_build_subscript_superscript",value:function(e,t,n){return"subscriptsuperscript"===e.expr_type()&&(null===e.subscript_expr&&!n||null===e.superscript_expr&&n)?new R(e.base_expr,n?e.subscript_expr:t,n?t:e.superscript_expr):(e=$.autoparenthesize(e),new R(e,n?null:t,n?t:null))}},{key:"make_subscript_superscript",value:function(e,t){var n=e.pop_exprs(2),i=Object(c.a)(n,3),r=i[0],s=i[1],a=i[2],o=this._build_subscript_superscript(s,a,t);return r.push_expr(o)}},{key:"do_subscript",value:function(e){return this.make_subscript_superscript(e,!1)}},{key:"do_superscript",value:function(e){return this.make_subscript_superscript(e,!0)}},{key:"do_prime",value:function(e){var t=e.pop_exprs(1),n=Object(c.a)(t,2),i=n[0],r=n[1],s=new T("prime",[]);if("subscriptsuperscript"===r.expr_type()&&r.superscript_expr){var a,o=r.superscript_expr,u=function(e){return"command"===e.expr_type()&&0===e.operand_count()&&"prime"===e.command_name};if(a=u(o)?new B([o,s]):"sequence"===o.expr_type()&&o.exprs.every(u)?new B(o.exprs.concat([s])):null){var l=new R(r.base_expr,r.subscript_expr,a);return i.push_expr(l)}}var _=this._build_subscript_superscript(r,s,!0);return i.push_expr(_)}},{key:"do_mode",value:function(e,t){this.switch_to_mode(t)}},{key:"do_undo",value:function(){this.perform_undo_or_redo="undo"}},{key:"do_redo",value:function(){this.perform_undo_or_redo="redo"}},{key:"do_dup",value:function(e){var t=e.pop(1),n=Object(c.a)(t,2),i=n[0],r=n[1];return i.push_all([r,r])}},{key:"do_pop",value:function(e){var t=e.pop(1),n=Object(c.a)(t,2),i=n[0];n[1];return i}},{key:"do_nip",value:function(e){var t=e.pop(2),n=Object(c.a)(t,3),i=n[0],r=(n[1],n[2]);return i.push(r)}},{key:"do_swap",value:function(e){var t=e.pop(2),n=Object(c.a)(t,3),i=n[0],r=n[1],s=n[2];return i.push_all([s,r])}},{key:"do_tuck",value:function(e){var t=e.pop(2),n=Object(c.a)(t,3),i=n[0],r=n[1],s=n[2];return i.push_all([s,r,s])}},{key:"do_over",value:function(e){var t=e.pop(2),n=Object(c.a)(t,3),i=n[0],r=n[1],s=n[2];return i.push_all([r,s,r])}},{key:"do_rot",value:function(e){var t=e.pop(3),n=Object(c.a)(t,4),i=n[0],r=n[1],s=n[2],a=n[3];return i.push_all([s,a,r])}},{key:"do_unrot",value:function(e){var t=e.pop(3),n=Object(c.a)(t,4),i=n[0],r=n[1],s=n[2],a=n[3];return i.push_all([a,r,s])}},{key:"do_reverse_n",value:function(e){var t=e.pop_positive_integer(),n=Object(c.a)(t,2),i=n[0],r=n[1],s=i.pop(r),a=Object(f.a)(s),o=a[0],u=a.slice(1);return u.reverse(),o.push_all(u)}},{key:"do_reverse_all",value:function(e){var t=e.pop(e.depth()),n=Object(f.a)(t),i=n[0],r=n.slice(1);return r.reverse(),i.push_all(r)}},{key:"do_clear_stack",value:function(){return new K([])}},{key:"do_change_document_selection",value:function(e,t){var n=parseInt(t);this.new_document=this.app_state.document.move_selection_by(n)}},{key:"do_shift_document_selection",value:function(e,t){var n=parseInt(t),i=this.app_state.document.shift_selection_by(n);i?this.new_document=i:this.error_flash_document()}},{key:"do_save_file",value:function(e){var t=this,n=this.app_component.state.file_manager_state.current_filename;if(!n)return this.do_save_file_as(e);this.app_component.state.document_storage.save_state(this.app_state,n,(function(){t.notify("Saved: "+n),t.settings.last_opened_filename=n,t.settings.save(),t.perform_undo_or_redo="clear",t.app_component.request_file_list()}),(function(){return t.notify("Error saving:"+n)})),this.file_saved=!0}},{key:"do_save_file_as",value:function(e){var t=this,n=window.prompt("Enter the filename to save as",this.settings.current_filename);if(n){var i=this.app_component.state.document_storage;n=i.sanitize_filename(n),i.save_state(this.app_state,n,(function(){t.notify("Saved as: "+n);var e=t.app_component.state.file_manager_state;e.selected_filename=e.current_filename=n,t.settings.last_opened_filename=n,t.settings.save(),t.perform_undo_or_redo="clear",t.app_component.request_file_list()}),(function(){return t.notify("Error saving: "+n)})),this.file_saved=!0}}},{key:"do_load_selected_file",value:function(e){var t=this.app_component.state.file_manager_state.selected_filename;if(!t)return this.error_flash_document();this.do_save_file(e),this.app_component.start_loading_filename(t)}},{key:"do_start_new_file",value:function(e){var t=this.app_component.state.file_manager_state,n=this.app_component.state.document_storage,i=t.generate_unused_filename(t.current_filename||"untitled");if(i=window.prompt("Enter a filename for the new document",i)){if(i=n.sanitize_filename(i||"")){t.current_filename&&n.save_state(this.app_state,t.current_filename);var r=new C;return this.new_document=r.document,t.selected_filename=t.current_filename=i,this.settings.last_opened_filename=i,this.settings.save(),this.perform_undo_or_redo="clear",this.notify("Started new file: "+i),this.files_changed=!0,this.file_saved=!0,this.do_toggle_popup(r.stack,"files"),r.stack}alert("Invalid filename (must only contain letters, numbers and underscores)")}}},{key:"do_select_adjacent_file",value:function(e,t){var n=parseInt(t),i=this.app_component.state.file_manager_state,r=i.find_adjacent_filename(i.selected_filename,n);r&&(i.selected_filename=r,this.files_changed=!0)}},{key:"do_delete_selected_file",value:function(e){var t=this,n=this.app_component.state.file_manager_state,i=this.app_component.state.document_storage,r=n.selected_filename;if(!r)return this.error_flash_document();window.confirm('Really delete "'+r+'"?')&&i.delete_state(r,(function(){t.notify("Deleted: "+r);var e=n.find_adjacent_filename(r,1);n.selected_filename=e,t.settings.last_opened_filename=e,t.settings.save(),t.app_component.request_file_list()}),(function(){return t.notify("Error deleting: "+r)}))}},{key:"do_pop_to_document",value:function(e,t){var n=e.pop(1),i=Object(c.a)(n,2),r=i[0],s=i[1];return this.new_document=this.app_state.document.insert_item(s),r}},{key:"do_copy_to_document",value:function(e,t){var n=e.peek(1);this.new_document=this.app_state.document.insert_item(n)}},{key:"do_recall_from_document",value:function(e,t){var n=this.app_state.document.selected_item();if(n)return e.push(n);this.error_flash_document()}},{key:"do_extract_from_document",value:function(e,t){var n=this.app_state.document.selected_item();if(n)return this.new_document=this.app_state.document.delete_selection(),e.push(n);this.error_flash_document()}},{key:"do_edit_stack_top",value:function(e){var t,n=e.peek(1);switch(n.item_type()){case"markdown":t=n.source_text;break;case"expr":t=["$$",n.expr.to_latex(),"$$"].join("");break;default:t="???"}this.switch_to_mode("editor"),this.minieditor={active:!0,text:t}}},{key:"do_edit_new_item",value:function(e){var t=this.do_insert_markdown(e,"");return this.do_edit_stack_top(t),t}},{key:"do_import_item_into_editor",value:function(e){this.switch_to_mode("editor");var t,n=e.pop(2),i=Object(c.a)(n,3),r=i[0],s=i[1],a=i[2];switch(s.item_type()){case"markdown":t=s.source_text;break;case"expr":t="$"+s.expr.to_latex()+"$";break;default:t="???"}return this._insert_text_into_minieditor(t),r.push(a)}},{key:"_insert_text_into_minieditor",value:function(e){if(!this.minieditor.active)return!1;var t=this.minieditor.ref.current;return!!t&&(t.setRangeText?t.setRangeText(e,t.selectionStart,t.selectionEnd,"end"):(t.focus(),document.execCommand("insertText",!1,e)),!0)}},{key:"do_finish_editing",value:function(e){if(this.minieditor.active){var t=this.minieditor.ref.current,n=((t?t.value:null)||"").trim(),i=e.pop(1),r=Object(c.a)(i,2),s=r[0],a=r[1];if(this.minieditor={active:!1},n.length>0){var o=P.from_string(n);return"expr"===o.item_type()&&"expr"===a.item_type()&&a.expr.to_latex()===o.expr.to_latex()?s.push(a):s.push(P.from_string(n))}return s}}},{key:"do_cancel_editing",value:function(e){var t=e.pop(1),n=Object(c.a)(t,2),i=n[0],r=n[1];return this.minieditor={active:!1},"markdown"===r.item_type()&&r.is_empty()?i:i.push(r)}},{key:"do_insert_markdown",value:function(e,t){return e.push(new H(t))}},{key:"do_insert",value:function(e,t){return(t=t||"").startsWith("\\")?e.push_expr(new T(t.slice(1))):e.push_expr(new L(t))}},{key:"do_self_insert",value:function(e){return this.do_insert(e,this.last_keypress)}},{key:"do_insert_defer",value:function(e){return e.push_expr(new U)}},{key:"do_to_case",value:function(e,t){var n=function(e){switch(t){case"uppercase":return e.toUpperCase();case"lowercase":return e.toLowerCase();default:return e}},i=e.pop(1),r=Object(c.a)(i,2),s=r[0],a=r[1];switch(a.item_type()){case"markdown":return s.push(new H(n(a.source_text)));case"expr":var o;return o="text"===a.expr.expr_type()?new L(n(a.expr.text)):a.expr,s.push_expr(o);default:return e.type_error()}}},{key:"do_operator",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"1",i=parseInt(n),r=e.pop_exprs(i),s=Object(f.a)(r),a=s[0],o=s.slice(1),c=new T(t,o);return a.push_expr(c)}},{key:"do_named_function",value:function(e,t,n){var i,r=e.pop_exprs(1),s=Object(c.a)(r,2),a=s[0],o=s[1];i="sech"===t||"csch"===t?new T("operatorname",[new L(t)]):new T(t),void 0!==n&&(i=new R(i,null,new L(n)));var u=I.combine_pair(i,$.autoparenthesize(o));return a.push_expr(u)}},{key:"do_apply_hat",value:function(e,t){var n=e.pop_exprs(1),i=Object(c.a)(n,2),r=i[0],s=i[1];if("text"!==s.expr_type()||"i"!==s.text&&"j"!==s.text){if("command"===s.expr_type()&&1===s.operand_count()&&("boldsymbol"===s.command_name||"mathbf"===s.command_name)){var a=s.operand_exprs[0];"text"!==a.expr_type()||"i"!==a.text&&"j"!==a.text||(s=new T(s.command_name,[new T("i"===a.text?"imath":"jmath")]))}}else s=new T("i"===s.text?"imath":"jmath");var o=new T(t,[s]);return r.push_expr(o)}},{key:"do_color",value:function(e,t){var n=e.pop_exprs(1),i=Object(c.a)(n,2),r=i[0],s=i[1];"command"===s.expr_type()&&"textcolor"===s.command_name&&2===s.operand_count()&&(s=s.operand_exprs[1]);var a=new T("textcolor",[new L(t),s]);return r.push_expr(a)}},{key:"do_accumulate",value:function(e,t){return this.switch_to_mode("accumulate"),this.perform_undo_or_redo="suppress",e.push_expr(new M(t,""))}},{key:"do_custom_delimiter",value:function(e,t){if(this.switch_to_mode("custom_delimiters"),t){if(this.custom_delimiters.left)return this.custom_delimiters.right?(this.custom_delimiters.middle=t,this._finish_custom_delimiters(e)):(this.custom_delimiters.right=t,1===this.custom_delimiters.arity?this._finish_custom_delimiters(e):void 0);this.custom_delimiters.left=t}else this.custom_delimiters={arity:1}}},{key:"do_custom_delimiter_arity",value:function(e,t){this.switch_to_mode("custom_delimiters"),this.custom_delimiters.arity=parseInt(t)}},{key:"_finish_custom_delimiters",value:function(e){this.switch_to_mode("base");var t=this.custom_delimiters,n=e.pop_exprs(t.arity),i=Object(f.a)(n),r=i[0],s=i.slice(1),a=new $(t.left,t.right,t.middle,s);return this.custom_delimiters={},r.push_expr(a)}},{key:"do_infix",value:function(e,t){var n,i=e.pop_exprs(2),r=Object(c.a)(i,3),s=r[0],a=r[1],o=r[2];return n=t.startsWith("\\")?new T(t.slice(1)):new L(t),s.push_expr(new D(n,a,o))}},{key:"do_prefix",value:function(e,t){var n,i=e.pop_exprs(1),r=Object(c.a)(i,2),s=r[0],a=r[1];return n=t.startsWith("\\")?new T(t.slice(1)):new L(t),s.push_expr(new A(a,n))}},{key:"do_infix_plus_or_minus",value:function(e,t){var n,i=e.pop_exprs(2),r=Object(c.a)(i,3),s=r[0],a=r[1],o=r[2];return"prefix"===o.expr_type()&&"text"===o.prefix_expr.expr_type()&&"-"===o.prefix_expr.text?(n=new L("-"===t?"+":"-"),o=o.base_expr):n=new L(t),s.push_expr(new D(n,a,o))}},{key:"do_stackrel",value:function(e,t){var n=e.pop_exprs(2),i=Object(c.a)(n,3),r=i[0],s=i[1],a=i[2];if("infix"===s.expr_type()){var o=new T(t,[a,s.operator_expr]),u=new D(o,s.left_expr,s.right_expr);return r.push_expr(u)}this.error_flash_stack()}},{key:"do_cancel",value:function(){}},{key:"do_name",value:function(){}},{key:"do_concat",value:function(e,t){var n=e.pop(2),i=Object(c.a)(n,3),r=i[0],s=i[1],a=i[2];if("expr"===s.item_type()&&"expr"===a.item_type()){var o=s.expr,u=a.expr;"autoparenthesize"===t&&(o=$.autoparenthesize(o),u=$.autoparenthesize(u));var l=I.combine_pair(o,u);return r.push_expr(l)}if("markdown"===s.item_type()&&"markdown"===a.item_type()){var _=s.source_text+a.source_text;return r.push(new H(_))}return e.type_error()}},{key:"do_substitute_defer",value:function(e){var t=e.pop_exprs(2),n=Object(c.a)(t,3),i=n[0],r=n[1],s=n[2],a=r.find_defer();if(a){var o=r.substitute_expr(a,s);return i.push_expr(o)}return e.type_error()}},{key:"do_append_text_input",value:function(e){var t,n=this.last_keypress,i=e.pop_exprs(1),r=Object(c.a)(i,2),s=r[0],a=r[1];if("accumulator"===a.expr_type())if(a.is_valid_character(n))t=a.with_extra_character(n);else{if("latex"===a.accumulator_type&&" "===n)return this.do_finish_text_input(e);t=a}else t=a;return this.switch_to_mode("accumulate"),this.perform_undo_or_redo="suppress",s.push_expr(t)}},{key:"do_backspace_text_input",value:function(e){this.switch_to_mode("accumulate"),this.perform_undo_or_redo="suppress";var t,n=e.pop_exprs(1),i=Object(c.a)(n,2),r=i[0],s=i[1];if("accumulator"===s.expr_type()){if(s.is_empty())return this.switch_to_mode("base"),r;t=s.without_last_character()}else t=s;return r.push_expr(t)}},{key:"do_finish_text_input",value:function(e,t){var n=e.pop_exprs(1),i=Object(c.a)(n,2),r=i[0],s=i[1];if("accumulator"===s.expr_type()){var a=s.finished_expr();return a?("roman"===t&&(a=new T("mathrm",[a])),r.push_expr(a)):r}return r}},{key:"do_delimiters",value:function(e,t,n,i,r){var s=void 0===r?1:parseInt(r),a=e.pop_exprs(s),o=Object(f.a)(a),c=o[0],u=o.slice(1),l=new $(t,n,i,u);return c.push_expr(l)}},{key:"do_parenthesize",value:function(e){var t=e.pop_exprs(1),n=Object(c.a)(t,2),i=n[0],r=n[1];return"delimiter"===r.expr_type()&&"."===r.left_type&&"."===r.right_type&&r.inner_exprs.length>1?r=new $("(",")",r.middle_type,r.inner_exprs):"delimiter"!==r.expr_type()&&(r=$.parenthesize(r)),i.push_expr(r)}},{key:"do_autoparenthesize",value:function(e){var t=e.pop_exprs(1),n=Object(c.a)(t,2),i=n[0],r=n[1];return i.push_expr($.autoparenthesize(r))}},{key:"do_apply_operator",value:function(e,t){var n=parseInt(t),i=e.pop_exprs(n+1),r=Object(f.a)(i),s=r[0],a=r.slice(1),o=a[a.length-1],c=a.slice(0,n);if("command"===o.expr_type()&&0===o.operand_count())return s.push_expr(new T(o.command_name,c));this.error_flash_stack()}},{key:"do_apply_infix",value:function(e){var t=e.pop_exprs(3),n=Object(c.a)(t,4),i=n[0],r=n[1],s=n[2],a=n[3],o=new D(a,r,s);return i.push_expr(o)}},{key:"do_toggle_popup",value:function(e,t){if("help"===this.settings.popup_mode){var n=document.getElementById("popup_panel");n&&n.scrollTop&&(this.settings.help_scroll_top=n.scrollTop)}this.settings.popup_mode=this.settings.popup_mode===t?null:t,this.settings.save(),this.app_component.apply_layout_to_dom()}},{key:"do_config",value:function(e,t,n){var i=this.settings,r=i.layout;switch(t){case"zoom_factor":switch(n){case"0":r.zoom_factor=0;break;case"+":r.zoom_factor++;break;case"-":r.zoom_factor--}break;case"math_align":switch(n){case"toggle_document":r.document_rightalign_math=!r.document_rightalign_math;break;case"toggle_stack":r.stack_rightalign_math=!r.stack_rightalign_math}break;case"stack_side":r.stack_side=n;break;case"stack_split":r.stack_split=parseInt(n);break;case"theme":i.selected_theme=n;break;case"reset_layout":i.layout=i.default_layout()}i.save(),this.app_component.apply_layout_to_dom(),this.clear_all_flashes()}},{key:"do_build_matrix_row",value:function(e,t){var n=e.pop_positive_integer(),i=Object(c.a)(n,2),r=i[0],s=i[1],a=r.pop_exprs(s),o=Object(f.a)(a),u=o[0],l=o.slice(1),_=new W(t||"bmatrix",1,s,[l]);return u.push_expr(_)}},{key:"do_stack_matrices",value:function(e){var t=e.pop_matrices(2),n=Object(c.a)(t,3),i=n[0],r=n[1],s=n[2];r.column_count!==s.column_count&&i.type_error();var a=new W(s.array_type,r.row_count+s.row_count,r.column_count,r.element_exprs.concat(s.element_exprs));return i.push_expr(a)}},{key:"do_split_matrix",value:function(e){var t=e.pop_matrices(1),n=Object(c.a)(t,2),i=n[0],r=n[1];return i.push_all_exprs(r.split_rows())}},{key:"do_dissolve_matrix",value:function(e){var t,n=e.pop_matrices(1),i=Object(c.a)(n,2),r=i[0],s=i[1],a=(t=[]).concat.apply(t,Object(o.a)(s.element_exprs));return r.push_all_exprs(a)}},{key:"do_insert_matrix_ellipses",value:function(e){var t=e.pop_matrices(1),n=Object(c.a)(t,2),i=n[0],r=n[1];return i.push_expr(r.with_ellipses())}},{key:"do_matrix_transpose",value:function(e){var t=e.pop_matrices(1),n=Object(c.a)(t,2),i=n[0],r=n[1];return i.push_expr(r.transposed())}},{key:"do_build_align",value:function(e,t){var n,i=e.pop_positive_integer(),r=Object(c.a)(i,2),s=r[0],a=r[1],o=s.pop_exprs(a),u=Object(f.a)(o),l=u[0],_=u.slice(1);switch(t){case"gathered":case"gather":n="none";break;case"cases":case"rcases":n="colon";break;default:n="infix"}var p=W.split_elements(_,n),h=new W(t,p.length,p[0].length,p);return l.push_expr(h)}},{key:"do_build_list",value:function(e,t,n){for(var i=e.pop_positive_integer(),r=Object(c.a)(i,2),s=r[0],a=r[1],o=s.pop_exprs(a),u=Object(f.a)(o),l=u[0],_=u.slice(1),p=_[0],h=1;h<a;h++){var m=n&&h===a-1?n:t;p=I.combine_pair(p,new L(m)),p=I.combine_pair(p,_[h])}return l.push_expr(p)}},{key:"do_build_infix_list",value:function(e,t){var n=e.pop_positive_integer(),i=Object(c.a)(n,2),r=i[0],s=i[1],a=r.pop_exprs(1),o=Object(c.a)(a,2),u=o[0],l=o[1],_=u.pop_exprs(s),p=Object(f.a)(_),h=p[0],m=p.slice(1),d=m[s-1];t&&s>1&&(d=new D(l,new L(t),d));for(var v=s-2;v>=0;v--)d=new D(l,m[v],d);return h.push_expr(d)}},{key:"do_build_substack",value:function(e){var t=e.pop_positive_integer(),n=Object(c.a)(t,2),i=n[0],r=n[1],s=i.pop_exprs(r),a=Object(f.a)(s),o=a[0],u=a.slice(1).map((function(e){return e.to_latex()})).join("\\\\"),l=new T("substack",[new L(u)]);return o.push_expr(l)}},{key:"do_apply_tag",value:function(e){var t,n=e.pop(2),i=Object(c.a)(n,3),r=i[0],s=i[1],a=i[2];if("expr"!==s.item_type())return e.type_error();if("markdown"===a.item_type())t=new T("text",[new L(a.source_text.trim())]);else{if("expr"!==a.item_type())return e.type_error();t=a.expr}return r.push(new V(s.expr,t))}},{key:"do_copy_to_clipboard",value:function(e){var t=e.pop(1),n=Object(c.a)(t,2),i=n[0],r=n[1];return this.app_component.state.clipboard_item=r,this.notify("Copied to clipboard"),i.push(r)}},{key:"do_paste_from_clipboard",value:function(e){var t=this.app_component.state.clipboard_item;if(t)return e.push(t);this.error_flash_stack()}},{key:"do_recenter_document",value:function(e,t){var n=parseInt(t);this.perform_undo_or_redo="suppress";var i=document.getElementById("document_container");if(i){var r=i.getElementsByClassName("selected");if(0!==r.length){var s=r[0],a=s.offsetTop,o=s.offsetTop+s.offsetHeight-i.clientHeight,c=n/100,u=Math.round(a*(1-c)+o*c);i.scrollTop=u}}}},{key:"do_scroll_popup_panel",value:function(e,t){var n=document.getElementById("popup_panel");if(n){var i=parseInt(t||"50")/100;n.scrollTop+=Math.round(n.clientHeight*i)}}},{key:"do_export_document_as_text",value:function(e){var t=this.app_state.document.to_text();navigator.clipboard.writeText(t),this.notify("Copied document to clipboard")}},{key:"do_export_stack_top_as_text",value:function(e){var t=e.pop(1),n=Object(c.a)(t,2),i=n[0],r=n[1],s=r.to_text();return navigator.clipboard.writeText(s),this.notify("Copied stack top to clipboard"),i.push(r)}}]),e}(),X=r.a.createElement,G=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e){var i;Object(u.a)(this,n),i=t.call(this,e);var r=O.load_from_local_storage();return i.state={app_state:new C,settings:r,file_manager_state:new q,import_export_state:new N,document_storage:new z,input_context:new J(Object(_.a)(i),r),undo_stack:new S,clipboard_item:null},i.state.undo_stack.clear(i.state.app_state),i.state.import_export_state.document_storage=i.state.document_storage,i.state.import_export_state.onstatechange=function(){return i.import_export_state_changed()},i.handleKeyDown=i.handleKeyDown.bind(Object(_.a)(i)),i.handleBeforeUnload=i.handleBeforeUnload.bind(Object(_.a)(i)),i.handleVisibilityChange=i.handleVisibilityChange.bind(Object(_.a)(i)),i.state.document_storage.open_database(i.on_open_database.bind(Object(_.a)(i))),i}return Object(l.a)(n,[{key:"on_open_database",value:function(){if(this.request_file_list(),this.state.settings.last_opened_filename)this.start_loading_filename(this.state.settings.last_opened_filename);else{var e=this.state.file_manager_state,t=this.state.settings,n="untitled";e.current_filename=e.selected_filename=n,t.last_opened_filename=n,t.save()}}},{key:"file_manager_state_changed",value:function(){this.setState({file_manager_state:this.state.file_manager_state})}},{key:"import_export_state_changed",value:function(){var e=this.state.import_export_state;this.setState({import_export_state:e}),e.file_list_needs_update&&(e.file_list_needs_update=!1,this.request_file_list())}},{key:"request_file_list",value:function(){this.state.document_storage.fetch_file_list(this.file_list_request_finished.bind(this),this.file_list_request_error.bind(this))}},{key:"file_list_request_finished",value:function(e){var t=this.state.file_manager_state;t.unavailable=!1,t.file_list=e,t.sort_file_list("filename",!0),this.setState({file_manager_state:t})}},{key:"file_list_request_error",value:function(){var e=this.state.file_manager_state;e.unavailable=!0,this.setState({file_manager_state:e})}},{key:"start_loading_filename",value:function(e){this.state.document_storage.load_state(e,this.file_load_finished.bind(this),this.file_load_error.bind(this))}},{key:"file_load_finished",value:function(e,t){var n=this.state.file_manager_state,i=this.state.settings;n.selected_filename=n.current_filename=e,i.last_opened_filename=e,i.save(),this.setState({app_state:t,file_manager_state:n}),this.state.undo_stack.clear(t),this.state.input_context.notify("Loaded: "+e)}},{key:"file_load_error",value:function(e,t){}},{key:"componentDidMount",value:function(){this.apply_layout_to_dom(),window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("beforeunload",this.handleBeforeUnload),window.addEventListener("visibilitychange",this.handleVisibilityChange),this.request_file_list()}},{key:"apply_layout_to_dom",value:function(){this.stack_panel_ref.current&&this.document_panel_ref.current&&this.popup_panel_ref.current&&this.state.settings.apply_layout_to_dom(this.stack_panel_ref.current,this.document_panel_ref.current,this.popup_panel_ref.current)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("beforeunload",this.handleBeforeUnload),window.removeEventListener("visibilitychange",this.handleVisibilityChange)}},{key:"render",value:function(){var e=this.state.app_state;return this.stack_panel_ref=r.a.createRef(),this.document_panel_ref=r.a.createRef(),this.popup_panel_ref=r.a.createRef(),X("div",{id:"panel_layout",className:"theme_"+this.state.settings.selected_theme},X("div",{className:"panel stack_panel",id:"stack_panel",ref:this.stack_panel_ref},X(Z,{app_state:e,input_context:this.state.input_context}),X(Y,{settings:this.state.settings,stack:e.stack,input_context:this.state.input_context})),X("div",{className:"panel document_panel",id:"document_panel",ref:this.document_panel_ref},X("div",{id:"document_container"},X(Q,{settings:this.state.settings,document:e.document,filename:this.state.file_manager_state.current_filename,is_dirty:e.is_dirty}))),X(ie,{settings:this.state.settings,popup_panel_ref:this.popup_panel_ref,import_export_state:this.state.import_export_state,document_storage:this.state.document_storage,file_manager_state:this.state.file_manager_state}))}},{key:"handleKeyDown",value:function(e){if(!e.altKey&&!e.metaKey){var t=this._keyname_from_event(e),n=this.state.app_state,i=this.state.input_context.handle_key(n,t),r=Object(c.a)(i,2),s=r[0],a=r[1];if(s){e.preventDefault();var o=this.manage_undo_state(a);o?a=o:this.state.input_context.error_flash_stack();var u={app_state:a};this.state.input_context.files_changed&&(this.request_file_list(),u.file_manager_state=this.state.file_manager_state),this.setState(u)}}}},{key:"_keyname_from_event",value:function(e){var t=e.key;return(t.startsWith("Arrow")||"Enter"===t||"Backspace"===t)&&e.shiftKey&&(t="Shift+"+t),e.ctrlKey&&(t="Ctrl+"+t),t}},{key:"handleBeforeUnload",value:function(e){var t=this.state.file_manager_state.current_filename;return t&&this.state.document_storage.save_state(this.state.app_state,t),null}},{key:"handleVisibilityChange",value:function(e){this.setState({})}},{key:"manage_undo_state",value:function(e){var t=this.state.undo_stack;switch(this.state.input_context.perform_undo_or_redo){case"undo":return t.undo_state();case"redo":return t.redo_state();case"suppress":return e;case"clear":return t.clear(e),e;default:return t.push_state(e),e}}}]),n}(r.a.Component),Z=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=void 0,t=this.props.input_context.notification_text;if(t){var n=t.indexOf(":");e=n>=0?X("span",{className:"notification"},X("span",{},t.slice(0,n+1)),X("span",{className:"highlighted"},t.slice(n+1))):X("span",{className:"notification"},t)}else"base"!==this.props.input_context.mode&&(e=X("span",{className:"mode"},this.props.input_context.mode.replaceAll("_"," ")));return X("div",{className:"indicator"},e)}}]),n}(r.a.Component),Y=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props.input_context,t=e.minieditor.active,n=this.props.stack.items.length-1,i=this.props.stack.items.map((function(i,s){return t&&s===n?(e.minieditor.ref=r.a.createRef(),X(ee,{textarea_ref:e.minieditor.ref,input_context:e,key:"minieditor"})):X(ne,{item:i,selected:!1,item_ref:r.a.createRef(),key:i.react_key(s)})})),s=["stack_items"];return this.props.settings.layout.stack_rightalign_math&&s.push("rightalign_math"),X("div",{className:s.join(" ")},i)}}]),n}(r.a.Component),Q=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this,t=this.props.document,n=t.items.map((function(n,i){var s=r.a.createRef(),a=t.selection_index===i+1;return a&&(e.selected_item_ref=s),X(ne,{item:n,selected:a,item_ref:s,key:n.react_key(i)})}));n.push(X("div",{className:"bottom_spacer",key:"bottom_spacer"}));var i=0===t.selection_index,s="selection_indicator"+(i?" visible":""),a=(this.props.filename||"???")+(this.props.is_dirty?"*":"");i&&(this.selected_item_ref=r.a.createRef());var o=X("div",{className:s,key:"selection_indicator",ref:i?this.selected_item_ref:null},this.props.filename&&X("span",{},"[ "),this.props.filename&&X("span",{className:"filename"},a),this.props.filename&&X("span",{}," ]")),c=["document_items"];return this.props.settings.layout.document_rightalign_math&&c.push("rightalign_math"),X("div",{className:c.join(" ")},[o].concat(n))}},{key:"componentDidUpdate",value:function(){this.ensure_selection_visible()}},{key:"ensure_selection_visible",value:function(){if(this.selected_item_ref){var e=this.selected_item_ref.current;if(e){var t=document.getElementById("document_container"),n=e.offsetHeight/2;e.offsetTop<t.scrollTop&&(t.scrollTop=e.offsetTop-n),e.offsetTop+e.offsetHeight>t.scrollTop+t.offsetHeight&&(t.scrollTop=e.offsetTop+e.offsetHeight-t.offsetHeight+n)}}}}]),n}(r.a.Component),ee=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return X("textarea",{className:"minieditor",onInput:this.handleOnInput.bind(this),spellCheck:"false",ref:this.props.textarea_ref})}},{key:"handleOnInput",value:function(e){var t=this.props.textarea_ref.current.value;this.props.input_context.minieditor.text=t}},{key:"componentDidMount",value:function(){var e=this.props.textarea_ref.current,t=this.props.input_context.minieditor.text;t&&(e.value=t),e.focus()}}]),n}(r.a.Component),te=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=!this.props.file_manager_state.unavailable;return this.file_input_ref=r.a.createRef(),X("div",{className:"file_header",id:"files_panel"},X("h2",{},"File Manager"),this.render_file_table(),this.render_shortcuts(),e&&X("h2",{},"Export/Import"),e&&this.render_export_import_section())}},{key:"render_export_import_section",value:function(){var e=this.props.import_export_state,t=[];if(t.push(X("p",{},"This section lets you download the internal browser document storage as a .zip file, or restore the internal storage from a previously downloaded export.")),t.push(X("p",{},X("strong",{},e.textual_state()))),"idle"===e.state&&t.push(X("p",{},X("a",{href:"#",onClick:this.start_exporting.bind(this)},"Prepare Export"))),e.download_available()){var n=e.generate_download_filename();t.push(X("p",{},X("a",{href:e.download_url,download:n},"Download: "+n)))}return"idle"===e.state&&t.push(X("p",{},X("span",{},"Import Zip File: "),X("input",{type:"file",ref:this.file_input_ref}),X("input",{type:"button",value:"Upload",onClick:this.handle_file_upload.bind(this)}))),"idle"===e.state&&e.import_result_string&&t.push(X("p",{},X("span",{style:{fontWeight:"bold"}},"Import result: "),X("span",{},e.import_result_string))),X.apply(void 0,["div",{}].concat(t))}},{key:"render_file_table",value:function(){var e=this,t=this.props.file_manager_state;return t.unavailable?X("p",{},"IndexedDB support unavailable in your browser.  You will be unable to save or load documents.  Note that Firefox disables IndexedDB when in Private Browsing mode."):t.file_list&&t.file_list.length>0?X("div",{},X("table",{className:"file_table"},X("thead",{},X("tr",{},X("th",{className:"filename"},"Filename"),X("th",{className:"filesize",colSpan:"2"},"Size"),X("th",{className:"timestamp",colSpan:"2"},"Last Modified"))),X("tbody",{},t.file_list.map((function(t,n){return e._render_file_list_row(t,n)}))))):t.file_list?X("p",{},"No files created yet."):X("p",{},"Fetching file list...")}},{key:"_render_file_list_row",value:function(e,t){var n=this.props.file_manager_state,i=[];e.filename===n.selected_filename&&i.push("selected_file"),e.filename===n.current_filename&&i.push("current_file");var r=e.document_item_count+e.stack_item_count;return X("tr",{className:i.join(" "),key:"file_"+e.filename},X("td",{className:"filename"},e.filename),X("td",{className:"filesize"},Math.floor((e.filesize+1023)/1024)+" kb"),X("td",{className:"filesize"},r+" object"+(1===r?"":"s")),X("td",{className:"timestamp"},e.timestamp.toLocaleDateString()),X("td",{className:"timestamp"},e.timestamp.toLocaleTimeString()))}},{key:"render_shortcuts",value:function(){var e=this.props.file_manager_state.current_filename,t=[["Escape","Close file manager"],["Arrows","Select next/previous file"],["Enter","Open selected file"],["d","Delete selected file"],["n","Start a new empty file"],["s","Save current file"+(e?" ("+e+")":"")],["S","Save as..."]].map((function(e){var t=Object(c.a)(e,2),n=t[0],i=t[1];return X("li",{},X("span",{className:"keybinding"},n),X("span",{}," "+i))}));return X.apply(void 0,["ul",{className:"keybindings"}].concat(Object(o.a)(t)))}},{key:"handle_file_upload",value:function(e){var t=this.file_input_ref.current;if(t){var n=t.files;1===n.length?this.start_importing(n[0]):n.length>1?alert("Please select a single .zip file to import."):alert("Please select a .zip file to import.")}}},{key:"start_importing",value:function(e){var t=this.props.import_export_state;"idle"===t.state&&t.start_importing(e)}},{key:"start_exporting",value:function(){var e=this.props.import_export_state;"idle"===e.state&&e.start_exporting()}}]),n}(r.a.Component),ne=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e=this.props.item,t=this.props.item_ref,n=this.props.selected?"selected ":"";switch(e.item_type()){case"expr":return e.tag_expr?(this.tag_ref=r.a.createRef(),X("div",{className:"expr_item"},X("div",{className:"tag_expr",ref:this.tag_ref},""),X("div",{className:n+"latex_fragment",ref:t},""))):X("div",{className:"expr_item"},X("div",{className:n+"latex_fragment",ref:t},""));case"markdown":return X("div",{className:n+"markdown",dangerouslySetInnerHTML:{__html:e.rendered_html},ref:t});default:return X("div",{},"????")}}},{key:"componentDidMount",value:function(){var e=this.props.item,t=this.props.item_ref.current;if(t)if("expr"===e.item_type())this._render_with_katex(e.expr.to_latex(),t,!0),e.tag_expr&&this.tag_ref.current&&this._render_with_katex(e.tag_expr.to_latex(),this.tag_ref.current,!1);else if("markdown"===e.item_type())for(var n=t.getElementsByTagName("code"),i=0;i<n.length;i++){var r=n[i],s=r.textContent||"";this._render_with_katex(s,r,!1)}}},{key:"_render_with_katex",value:function(e,t,n){""!==e&&"\\,"!==e||(e="\\htmlClass{defer_expr}{\\square}");try{d.a.render(e,t,{throwOnError:!1,displayMode:n,fleqn:!0,trust:!0})}catch(r){var i=r.toString();t.innerHTML='<div style="color:red;">'+i+"</div>"}}}]),n}(r.a.Component),ie=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){this.refs={help:r.a.createRef(),help_content:r.a.createRef()};var e=this.props.settings.popup_mode,t=null;return"files"===e?t=X("div",{id:"files_container"},X(te,{import_export_state:this.props.import_export_state,document_storage:this.props.document_storage,file_manager_state:this.props.file_manager_state})):"keymap"===e&&(t=X("div",{id:"keymap_container"},X(re,{keymap:y}))),X("div",{id:"popup_panel",ref:this.props.popup_panel_ref},t,X("div",{id:"help_container",ref:this.refs.help},X("div",{className:"help",ref:this.refs.help_content})))}},{key:"componentDidMount",value:function(){var e=document.getElementById("helptext"),t=this.refs.help_content.current;e&&(e.style.display="block",this._render_help_latex(e),e.parentNode.removeChild(e),t.appendChild(e))}},{key:"componentDidUpdate",value:function(){var e=this.props.settings.popup_mode;this.refs.help.current&&(this.refs.help.current.style.display="help"===e?"block":"none"),"help"===e&&void 0!==this.props.settings.help_scroll_top&&this.props.popup_panel_ref.current&&(this.props.popup_panel_ref.current.scrollTop=this.props.settings.help_scroll_top,this.props.settings.help_scroll_top=void 0)}},{key:"_render_help_latex",value:function(e){for(var t=e.getElementsByTagName("code"),n=0;n<t.length;n++){var i=t[n],r=i.textContent;r&&d.a.render(r,i,{throwOnError:!1,displayMode:!1})}}}]),n}(r.a.Component),re=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(){return Object(u.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return X("table",{className:"keymap"},X("thead",{},X("tr",{},X("th",{className:"mode"},"Mode"),X("th",{className:"keyname"},"Key"),X("th",{className:"command"},"Command"))),X("tbody",{},this.render_rows()))}},{key:"render_rows",value:function(){var e,t=this,n=this.get_sorted_mode_names().map((function(e){return t.rows_for_mode(e)}));return(e=[]).concat.apply(e,Object(o.a)(n))}},{key:"get_sorted_mode_names",value:function(){var e=this.props.keymap,t=Object(o.a)(Object.keys(e));return t.sort(),t}},{key:"rows_for_mode",value:function(e){var t=this,n=this.props.keymap[e],i=Object(o.a)(Object.keys(n));return i.sort(),i.map((function(i){return t.row_for_mode_and_key(e,i,n[i])}))}},{key:"row_for_mode_and_key",value:function(e,t,n){var i,r=e+"_"+t;return i=n.startsWith("name ")&&n.indexOf(";")?X("em",{},n.slice(5,n.indexOf(";"))):X("span",{},n),X("tr",{key:r},X("td",{className:"mode"},e),X("td",{className:"keyname"},X("span",{className:"keybinding"},t)),X("td",{className:"command"},i))}}]),n}(r.a.Component),se=G,ae=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function oe(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var ce=n(21);a.a.render(Object(ce.jsx)(se,{}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL(".",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat(".","/service-worker.js");ae?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var i=n.headers.get("content-type");404===n.status||null!=i&&-1===i.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):oe(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):oe(t,e)}))}}()}},[[37,1,2]]]);
//# sourceMappingURL=main.cca5283e.chunk.js.map